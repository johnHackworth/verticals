<html>
	<header>
		<link rel='stylesheet' id='all-css-0-1' href='https://s0.wp.com/_static/??-eJydU1tygzAMvFCNIZ1O8tPpWWxQiBI/GFsO5fYVJiEtaWkmPwySd1drWMm+E7V3BI6kTaIzqUUXZd/V3opo0cCwqIo6xhf5Oy0mHeuAHaHnau+N8f0a/uDPEIROWhtgNg0GZji62qSG29yQjYoHZIFYWHT3kGOUxOcn7T/nl7W5Bk8jC6hT9Unk6g5+xdIBLAgLLmUnt/JPRpu41BBaPgkgt8VrUUqd0DRSG58H6qDCsLjw0zLZ0gMymXW7NpwZxvDkqPG9e9jNQsaowScSbcDmWYmgCF27DMDDdEILBh38w98nY0REAgENjgMvcZBlUe2KzfhRueUjxWmAbDCSPCPcR/gqWfuLlarYsIrIizLxpoNispT/2tPGJk+GVb8bW3bX8q4aXhuhVbis8lxPJJTOU16v+WVNbYwj922naERYdq3AcAYdrdGm0Vp3AWIU/LSYrMjh/WecHaWnNc07+KMzUj/se/W2KzfldrOrjl+5bM9A?cssminify=yes' type='text/css' media='all' />
		<link rel='stylesheet' href='styles.css' type='text/css' media='all' />
		<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
 

	</header>
	<body>
		<div id="topbar">
			<button type="button" aria-pressed="true" aria-expanded="true" class="components-button is-pressed has-icon" aria-label="Settings"><svg aria-hidden="true" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="dashicon dashicons-admin-generic"><path d="M18 12h-2.18c-.17.7-.44 1.35-.81 1.93l1.54 1.54-2.1 2.1-1.54-1.54c-.58.36-1.23.63-1.91.79V19H8v-2.18c-.68-.16-1.33-.43-1.91-.79l-1.54 1.54-2.12-2.12 1.54-1.54c-.36-.58-.63-1.23-.79-1.91H1V9.03h2.17c.16-.7.44-1.35.8-1.94L2.43 5.55l2.1-2.1 1.54 1.54c.58-.37 1.24-.64 1.93-.81V2h3v2.18c.68.16 1.33.43 1.91.79l1.54-1.54 2.12 2.12-1.54 1.54c.36.59.64 1.24.8 1.94H18V12zm-8.5 1.5c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z"></path></svg></button>
		</div>

		<div id="verticalContent">
			<div id="browser" class="edit-post-editor-regions__content">
				<div id="template"></div>
			</div>
			<div id="sidebar" class="edit-post-editor-regions__sidebar">
				<div id="sidebarFixed">
					<div id="siteTitle">
						<h4>Enter your site name</h4>
						<input id="title" value="My Site"></input>
					</div>
					<div id="selector">
						<h4>Select your vertical</h4>
						<select name="vertical" id="vertical" onChange="selectVertical">
						    <option value="surf">Surf Shop</option>
						    <option value="cake">Bakery</option>
						    <option value="tour">Cycling news</option>
						</select>
					</div>
					<div id="templates">
						<h4>Select your layout</h4>
						<img id="barnsbury" src="https://s.wordpress.com/mshots/v1/https%3A%2F%2Fbarnsburydemo.wordpress.com%2F%3Ftheme_preview%3Dtrue?w=240" class="selected" />
						<img id="stratford" src="https://s.wordpress.com/mshots/v1/https%3A%2F%2Fstratforddemo.wordpress.com%2F%3Ftheme_preview%3Dtrue?w=240" />
						<img id="dalston" src="https://s.wordpress.com/mshots/v1/https%3A%2F%2Fdalstondemo.wordpress.com%2F%3Ftheme_preview%3Dtrue?w=240" />
					</div>
					<div id="updateButton">
						<button id="selectVertical"> Update </button>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script>
		var selectVertical = function() {
			refresh( $( '#vertical' ).val() );
		}
		var togglePannel = function() {
			$( '#sidebar' ).toggle();
		}

		var selectTemplate = function( img, dos4 ) { 
			$( '#templates img' ).removeClass( 'selected' );
			$( img.target ).addClass( 'selected' );
		}

		var refresh = function( verticalTemplate ) {
			var selectedTemplate =  $( '#templates img.selected' ).attr( 'id' );
			$.when( 
				$.getJSON( verticalTemplate + ".json"),
				$.get( selectedTemplate + ".html" )
			)
			.done( function( verticalRequest, templateRequest ) {
				console.log(1);
				var dom = $( templateRequest[ 0 ] );
				var vertical = verticalRequest[ 0 ];
				window.ver = vertical;
				window.dom = dom;

				var layers = [ 'primary', 'secondary', 'tertiary', 'cuaternary', 'quintinary' ];
				var sections = [ 'title', 'subtitle', 'description' ];

				layers.forEach( function( layer ) {
					sections.forEach( function( section ) {
						$( dom ).find( '*[data-vertical="text-' + section + '-' + layer + '"]' ).each( function( index, node) { $( node ).html( vertical.text[ section ][ layer ].pop() ); } );	
					} )
				} );

				$( dom ).find( '*[data-vertical="link-contact"]' ).each( function( index, node) { $( node ).html( vertical.link.contact.pop() ); } );	
				$( dom ).find( '*[data-vertical="link-section"]' ).each( function( index, node) { $( node ).html( vertical.link.section.pop() ); } );	

				$( dom ).find( '*[data-vertical="image-big"]' ).each( function( index, img ) { $( img ).attr( 'src', vertical.image.big.pop() ) } );

				$( dom ).find( '*[data-vertical="image-medium"]' ).each( function( index, img ) { $( img ).attr( 'src', vertical.image.medium.pop() ) } );

				$( dom ).find( '*[data-vertical="image-small"]' ).each( function( index, img ) { $( img ).attr( 'src', vertical.image.small.pop() ) } );

				$( dom ).find( '*[data-vertical="background-big"]' ).each( 
					function( index, img ) { 
						console.log('back-big', img )
						$( img ).attr( 'style', 'background-image:url(' + vertical.background.big.pop() + ')' );
					} );
				$( dom ).find( '*[data-vertical="background-medium"]' ).each( function( index, img ) { $( img ).attr( 'style', 'background-image:url(' + vertical.background.medium.pop() + ')' ) } ),

				dom = $( dom.html().split('{{title}}').join( $( '#title' ).val() ) );

				$('#template').html( dom );
			} );

		}

		var init = function( verticalTemplate ) {
			$.get( "barnsbury.html" )
			.done( function( templateRequest ) {
				$('#template').html( templateRequest );
			} );

		}

		$( '#selectVertical' ).click( selectVertical );
		$( '#topbar button' ).click( togglePannel );
		$( '#templates img').click( selectTemplate );
		init();
		
	</script>
</html>